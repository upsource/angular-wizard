/**
 * Easy to use Wizard library for AngularJS
 * @version v0.4.5 - 2015-06-23 * @link https://github.com/mgonto/angular-wizard
 * @author Martin Gontovnikas <martin@gon.to>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
function wizardButtonDirective(a){angular.module("mgo-angular-wizard").directive(a,function(){return{restrict:"A",replace:!1,require:"^wizard",link:function(b,c,d,e){c.on("click",function(c){c.preventDefault(),b.$apply(function(){b.$eval(d[a]),e[a.replace("wz","").toLowerCase()]()})})}}})}angular.module("templates-angularwizard",["step.html","wizard.html"]),angular.module("step.html",[]).run(["$templateCache",function(a){a.put("step.html",'<section ng-show="selected" ng-class="{current: selected, done: completed}" class="step" ng-transclude>\n</section>')}]),angular.module("wizard.html",[]).run(["$templateCache",function(a){a.put("wizard.html",'<div>\n    <div class="steps" ng-transclude></div>\n    <ul class="steps-indicator steps-{{steps.length}}" ng-if="!hideIndicators">\n      <li ng-class="{default: !step.completed && !step.selected, current: step.selected && !step.completed, done: step.completed && !step.selected, editing: step.selected && step.completed}" ng-repeat="step in steps">\n        <a ng-click="goTo(step)">{{step.title || step.wzTitle}}</a>\n      </li>\n    </ul>\n</div>\n')}]),angular.module("mgo-angular-wizard",["templates-angularwizard"]),angular.module("mgo-angular-wizard").directive("wzStep",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{wzTitle:"@",title:"@",canenter:"=",canexit:"="},require:"^wizard",templateUrl:function(a,b){return b.template||"step.html"},link:function(a,b,c,d){a.title=a.title||a.wzTitle,d.addStep(a)}}}),angular.module("mgo-angular-wizard").directive("wizard",["$q","$rootScope",function(a,b){function c(b,c,d){return a.when("undefined"==typeof b?!0:b(c,d))}return{restrict:"EA",replace:!0,transclude:!0,scope:{currentStep:"=",onFinish:"&",hideIndicators:"=",editMode:"=",name:"@",onEnter:"="},templateUrl:function(a,c){return b.$eval(c.template||"'wizard.html'")},controller:["$scope","$element","$log","WizardHandler",function(b,d,e,f){function g(){_.each(b.steps,function(a){a.selected=!1}),b.selectedStep=null}var h=!0,i=[];f.addWizard(b.name||f.defaultName,this),b.$on("$destroy",function(){f.removeWizard(b.name||f.defaultName)}),b.steps=[],b.context={},b.$watch("currentStep",function(a){if(a){var c=b.selectedStep.title||b.selectedStep.wzTitle;b.selectedStep&&c!==b.currentStep&&b.goTo(_.findWhere(b.steps,{title:b.currentStep}))}}),b.$watch("[editMode, steps.length]",function(){var a=b.editMode;_.isUndefined(a)||_.isNull(a)||a&&_.each(b.steps,function(a){a.completed=!0})},!0),this.addStep=function(a){b.steps.push(a),1===b.steps.length&&b.goTo(b.steps[0])},this.context=b.context,b.getStepNumber=function(a){return _.indexOf(b.steps,a)+1},b.goTo=function(d){if(!(i.length>0))if(h){var f=!0,j={currentStep:-1,requestedStep:b.getStepNumber(d)};angular.isFunction(b.onEnter)&&(f=b.onEnter(b.context,j,d)),a.when(f).then(function(){g(),b.selectedStep=d,_.isUndefined(b.currentStep)||(b.currentStep=d.title||d.wzTitle),d.selected=!0,b.$emit("wizard:stepChanged",{step:d,index:_.indexOf(b.steps,d)}),h=!1},function(a){e.log("error in onEnter function while changing step",a)})}else{var k,l=!1,m=!1;b.currentStepNumber()>0?k=b.currentStepNumber()-1:0===b.currentStepNumber()&&(k=0);var j={currentStep:k+1,requestedStep:b.getStepNumber(d)};i=[],i.push(c(b.steps[k].canexit,b.context,j).then(function(a){l=a},function(){l=!1})),i.push(c(d.canenter,b.context,j).then(function(a){m=a}),function(){m=!1}),a.all(i)["finally"](function(){if(b.getStepNumber(d)<b.currentStepNumber()&&(l=!0),l&&m){var c=!0;console.log("onEnterFn",b.onEnter),b.onEnter&&(c=b.onEnter(b.context,j,d)),a.when(c).then(function(){g(),b.selectedStep=d,_.isUndefined(b.currentStep)||(b.currentStep=d.title||d.wzTitle),d.selected=!0,b.$emit("wizard:stepChanged",{step:d,index:_.indexOf(b.steps,d)})},function(a){e.log("error in onEnter function while changing step",a)})}})["finally"](function(){i=[]})}},b.currentStepNumber=function(){return _.indexOf(b.steps,b.selectedStep)+1},this.currentStepNumber=function(){return b.currentStepNumber()},this.next=function(a){var c=_.indexOf(b.steps,b.selectedStep);if(angular.isFunction(a)){if(!a())return;c===b.steps.length-1?this.finish():b.goTo(b.steps[c+1])}a||(b.selectedStep.completed=!0),c===b.steps.length-1?this.finish():b.goTo(b.steps[c+1])},this.goTo=function(a){var c;c=_.isNumber(a)?b.steps[a]:_.findWhere(b.steps,{title:a}),b.goTo(c)},this.finish=function(){b.onFinish&&b.onFinish()},this.cancel=this.previous=function(){var a=_.indexOf(b.steps,b.selectedStep);if(0===a)throw new Error("Can't go back. It's already in step 0");b.goTo(b.steps[a-1])}}]}}]),wizardButtonDirective("wzNext"),wizardButtonDirective("wzPrevious"),wizardButtonDirective("wzFinish"),wizardButtonDirective("wzCancel"),angular.module("mgo-angular-wizard").factory("WizardHandler",function(){var a={},b={};return a.defaultName="defaultWizard",a.addWizard=function(a,c){b[a]=c},a.removeWizard=function(a){delete b[a]},a.wizard=function(c){var d=c;return c||(d=a.defaultName),b[d]},a});